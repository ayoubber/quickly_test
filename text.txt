text

# Implementation Guide - Remaining Pages

## Critical Pages to Complete

### 1. Links Management Page (`/dashboard/links/page.tsx`)

```typescript
'use client';

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card } from '@/components/ui/card';
import { createLink, updateLink, deleteLink, toggleLink, reorderLinks } from '@/actions/links';
import { DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { arrayMove, SortableContext, sortableKeyboardCoordinates, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { GripVertical, Plus, Edit, Trash2, Eye, EyeOff } from 'lucide-react';
import { toast } from 'sonner';

export default function LinksPage({ initialLinks }: { initialLinks: any[] }) {
  const [links, setLinks] = useState(initialLinks);
  const [isAdding, setIsAdding] = useState(false);
  const [editingId, setEditingId] = useState<string | null>(null);

  const sensors = useSensors(
    useSensor(PointerSensor),
    useSensor(KeyboardSensor, {
      coordinateGetter: sortableKeyboardCoordinates,
    })
  );

  async function handleDragEnd(event: any) {
    const { active, over } = event;
    if (active.id !== over.id) {
      const oldIndex = links.findIndex((l) => l.id === active.id);
      const newIndex = links.findIndex((l) => l.id === over.id);
      const newLinks = arrayMove(links, oldIndex, newIndex);
      setLinks(newLinks);
      
      await reorderLinks(newLinks.map(l => l.id));
      toast.success('Links reordered');
    }
  }

  async function handleToggle(id: string) {
    await toggleLink(id);
    const newLinks = links.map(l => 
      l.id === id ? { ...l, is_active: !l.is_active } : l
    );
    setLinks(newLinks);
    toast.success('Link updated');
  }

  async function handleDelete(id: string) {
    if (confirm('Delete this link?')) {
      await deleteLink(id);
      setLinks(links.filter(l => l.id !== id));
      toast.success('Link deleted');
    }
  }

  return (
    <div className="max-w-4xl">
      <div className="flex items-center justify-between mb-8">
        <h1 className="text-3xl font-bold">Manage Links</h1>
        <Button onClick={() => setIsAdding(true)}>
          <Plus className="w-4 h-4 mr-2" />
          Add Link
        </Button>
      </div>

      {/* Add/Edit Form Modal */}
      {isAdding && (
        <LinkFormModal
          onClose={() => setIsAdding(false)}
          onSave={async (link) => {
            const formData = new FormData();
            Object.entries(link).forEach(([key, value]) => {
              formData.append(key, String(value));
            });
            await createLink(formData);
            setIsAdding(false);
            toast.success('Link added!');
            window.location.reload();
          }}
        />
      )}

      {/* Links List - Sortable */}
      <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
        <SortableContext items={links.map(l => l.id)} strategy={verticalListSortingStrategy}>
          <div className="space-y-3">
            {links.map((link) => (
              <SortableLink
                key={link.id}
                link={link}
                onToggle={handleToggle}
                onDelete={handleDelete}
              />
            ))}
          </div>
        </SortableContext>
      </DndContext>

      {links.length === 0 && (
        <Card className="p-12 text-center text-gray-400">
          <p>No links yet. Click "Add Link" to get started!</p>
        </Card>
      )}
    </div>
  );
}

function SortableLink({ link, onToggle, onDelete }: any) {
  const { attributes, listeners, setNodeRef, transform, transition } = useSortable({ id: link.id });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
  };

  return (
    <div ref={setNodeRef} style={style} className="glass rounded-lg p-4 flex items-center gap-4">
      <div {...attributes} {...listeners} className="cursor-grab text-gray-500 hover:text-white">
        <GripVertical className="w-5 h-5" />
      </div>

      <div className="flex-1">
        <div className="flex items-center gap-2">
          {link.icon && <span className="text-xl">{link.icon}</span>}
          <span className="font-semibold">{link.title}</span>
        </div>
        <p className="text-sm text-gray-400 truncate">{link.url}</p>
      </div>

      <div className="flex items-center gap-2">
        <button
          onClick={() => onToggle(link.id)}
          className={`p-2 rounded-lg transition ${
            link.is_active ? 'text-brand-gold hover:bg-brand-gold/10' : 'text-gray-500 hover:bg-white/5'
          }`}
        >
          {link.is_active ? <Eye className="w-4 h-4" /> : <EyeOff className="w-4 h-4" />}
        </button>
        <button onClick={() => onDelete(link.id)} className="p-2 rounded-lg text-red-500 hover:bg-red-500/10">
          <Trash2 className="w-4 h-4" />
        </button>
      </div>
    </div>
  );
}

function LinkFormModal({ onClose, onSave }: any) {
  const [formData, setFormData] = useState({
    title: '',
    url: '',
    icon: '',
    is_active: true,
  });

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
      <Card className="max-w-md w-full mx-4">
        <div className="p-6 space-y-4">
          <h2 className="text-xl font-bold">Add Link</h2>
          
          <Input
            label="Title"
            value={formData.title}
            onChange={(e) => setFormData({ ...formData, title: e.target.value })}
            placeholder="My Instagram"
          />

          <Input
            label="URL"
            value={formData.url}
            onChange={(e) => setFormData({ ...formData, url: e.target.value })}
            placeholder="https://instagram.com/username"
          />

          <Input
            label="Icon (emoji)"
            value={formData.icon}
            onChange={(e) => setFormData({ ...formData, icon: e.target.value })}
            placeholder="ðŸ“·"
          />

          <div className="flex gap-2">
            <Button onClick={() => onSave(formData)} className="flex-1">Save</Button>
            <Button onClick={onClose} variant="outline">Cancel</Button>
          </div>
        </div>
      </Card>
    </div>
  );
}
```

### 2. Card Activation Page (`/dashboard/cards/page.tsx`)

```typescript
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { activateCard } from '@/actions/cards';
import { toast } from 'sonner';
import { CreditCard, CheckCircle } from 'lucide-react';
import { formatRelativeTime } from '@/lib/utils/cn';

export default function CardsPage({ initialCards }: { initialCards: any[] }) {
  const [cards, setCards] = useState(initialCards);
  const [activationCode, setActivationCode] = useState('');
  const [isActivating, setIsActivating] = useState(false);

  async function handleActivate() {
    if (!activationCode) {
      toast.error('Please enter activation code');
      return;
    }

    setIsActivating(true);
    const result = await activateCard(activationCode);

    if (result?.error) {
      toast.error(result.error);
    } else if (result?.success) {
      toast.success('Card activated successfully!');
      setActivationCode('');
      window.location.reload();
    }

    setIsActivating(false);
  }

  return (
    <div className="max-w-4xl">
      <h1 className="text-3xl font-bold mb-8">Your Cards</h1>

      {/* Activation Form */}
      <Card className="mb-8">
        <CardHeader>
          <CardTitle>Activate New Card</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <p className="text-gray-400 text-sm">
            Enter the activation code from your card packaging to link it to your account.
          </p>
          
          <div className="flex gap-2">
            <Input
              value={activationCode}
              onChange={(e) => setActivationCode(e.target.value.toUpperCase())}
              placeholder="XXXX-XXXX-XXXX"
              className="flex-1"
            />
            <Button onClick={handleActivate} isLoading={isActivating}>
              Activate
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Cards List */}
      <div className="space-y-4">
        {cards.map((card: any) => (
          <Card key={card.id}>
            <CardContent className="pt-6">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 bg-gradient-to-br from-brand-gold to-brand-gold-light rounded-lg flex items-center justify-center">
                  <CreditCard className="w-6 h-6 text-brand-navy" />
                </div>
                
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-1">
                    <h3 className="font-semibold">Card #{card.card_uid.slice(-8)}</h3>
                    {card.status === 'assigned' && (
                      <CheckCircle className="w-4 h-4 text-green-500" />
                    )}
                  </div>
                  <p className="text-sm text-gray-400">
                    Activated {formatRelativeTime(card.activated_at)}
                  </p>
                </div>

                <div className="text-right">
                  <div className="text-sm font-semibold text-brand-gold capitalize">
                    {card.status}
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {cards.length === 0 && (
        <Card className="p-12 text-center text-gray-400">
          <CreditCard className="w-16 h-16 mx-auto mb-4 opacity-50" />
          <p>No cards activated yet</p>
          <p className="text-sm mt-2">Enter your activation code above to get started</p>
        </Card>
      )}
    </div>
  );
}
```

### 3. Store Page (`/store/page.tsx`)

```typescript
import { createClient } from '@/lib/supabase/server';
import Image from 'next/image';
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { ShoppingCart, Check } from 'lucide-react';

export default async function StorePage() {
  const supabase = await createClient();

  const { data: products } = await supabase
    .from('products')
    .select('*')
    .eq('is_active', true)
    .order('price', { ascending: true });

  return (
    <div className="min-h-screen">
      {/* Header (same as home page) */}
      {/* ... */}

      {/* Hero */}
      <section className="pt-32 pb-20">
        <div className="container mx-auto px-6 text-center">
          <h1 className="text-5xl font-bold mb-6">
            Choose Your <span className="gradient-text">Quickly</span> Card
          </h1>
          <p className="text-xl text-gray-400 max-w-2xl mx-auto">
            Premium NFC & QR cards that make networking effortless
          </p>
        </div>
      </section>

      {/* Products Grid */}
      <section className="pb-20">
        <div className="container mx-auto px-6">
          <div className="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto">
            {products?.map((product: any) => (
              <Card key={product.id} hover className="overflow-hidden">
                {product.images && product.images[0] && (
                  <div className="aspect-square bg-gradient-to-br from-brand-gold/20 to-brand-gold/5" />
                )}
                
                <div className="p-6">
                  <h3 className="text-2xl font-bold mb-2">{product.name}</h3>
                  <p className="text-gray-400 mb-4">{product.description}</p>
                  
                  <div className="mb-6">
                    <div className="text-3xl font-bold gradient-text mb-1">
                      ${product.price}
                    </div>
                    <div className="text-sm text-gray-400">One-time payment</div>
                  </div>

                  <ul className="space-y-2 mb-6 text-sm">
                    <li className="flex items-center gap-2">
                      <Check className="w-4 h-4 text-brand-gold" />
                      <span>NFC & QR technology</span>
                    </li>
                    <li className="flex items-center gap-2">
                      <Check className="w-4 h-4 text-brand-gold" />
                      <span>Customizable profile page</span>
                    </li>
                    <li className="flex items-center gap-2">
                      <Check className="w-4 h-4 text-brand-gold" />
                      <span>Unlimited link updates</span>
                    </li>
                    <li className="flex items-center gap-2">
                      <Check className="w-4 h-4 text-brand-gold" />
                      <span>Analytics dashboard</span>
                    </li>
                  </ul>

                  <Link href={`/checkout/${product.id}`}>
                    <Button className="w-full">
                      <ShoppingCart className="w-4 h-4 mr-2" />
                      Order Now
                    </Button>
                  </Link>
                </div>
              </Card>
            ))}
          </div>
        </div>
      </section>
    </div>
  );
}
```

### 4. How It Works Page (`/how-it-works/page.tsx`)

```typescript
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { Smartphone, Scan, Zap, Nfc } from 'lucide-react';

export default function HowItWorksPage() {
  return (
    <div className="min-h-screen">
      {/* Header */}
      {/* ... */}

      <section className="pt-32 pb-20">
        <div className="container mx-auto px-6">
          <div className="max-w-4xl mx-auto">
            <h1 className="text-5xl font-bold mb-6 text-center">
              How <span className="gradient-text">Quickly</span> Works
            </h1>

            {/* Guides */}
            <div className="space-y-16 mt-16">
              {/* NFC Guide */}
              <div>
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 bg-brand-gold/20 rounded-lg flex items-center justify-center">
                    <Nfc className="w-6 h-6 text-brand-gold" />
                  </div>
                  <h2 className="text-3xl font-bold">NFC Activation</h2>
                </div>

                <div className="glass rounded-xl p-8 space-y-6">
                  <div>
                    <h3 className="text-xl font-semibold mb-3">ðŸ“± For iPhone Users (iOS 13+)</h3>
                    <ol className="list-decimal list-inside space-y-2 text-gray-300">
                      <li>Make sure NFC is enabled (Settings â†’ General â†’ NFC)</li>
                      <li>Hold the top of your iPhone near the Quickly card</li>
                      <li>A notification will appear - tap to open</li>
                      <li>Your browser will open the profile page automatically</li>
                    </ol>
                  </div>

                  <div>
                    <h3 className="text-xl font-semibold mb-3">ðŸ¤– For Android Users</h3>
                    <ol className="list-decimal list-inside space-y-2 text-gray-300">
                      <li>Enable NFC in Settings â†’ Connected Devices â†’ Connection Preferences</li>
                      <li>Unlock your phone</li>
                      <li>Hold the back of your phone to the card</li>
                      <li>The profile page will open automatically</li>
                    </ol>
                  </div>
                </div>
              </div>

              {/* QR Guide */}
              <div>
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-12 h-12 bg-brand-gold/20 rounded-lg flex items-center justify-center">
                    <Scan className="w-6 h-6 text-brand-gold" />
                  </div>
                  <h2 className="text-3xl font-bold">QR Code Scanning</h2>
                </div>

                <div className="glass rounded-xl p-8">
                  <ol className="list-decimal list-inside space-y-3 text-gray-300">
                    <li>Open your phone's camera app</li>
                    <li>Point it at the QR code on the card</li>
                    <li>Tap the notification that appears</li>
                    <li>The profile page opens in your browser</li>
                  </ol>
                  <p className="mt-4 text-sm text-gray-400">
                    ðŸ’¡ Tip: QR codes work on all smartphones, even if NFC isn't available
                  </p>
                </div>
              </div>
            </div>

            <div className="mt-16 text-center">
              <Link href="/store">
                <Button size="lg">Get Your Card Today</Button>
              </Link>
            </div>
          </div>
        </div>
      </section>
    </div>
  );
}
```

## Server Component Wrappers

For client components that need server data, create wrapper pages:

```typescript
// /dashboard/links/page.tsx (server wrapper)
import { createClient } from '@/lib/supabase/server';
import { redirect } from 'next/navigation';
import LinksPageClient from './page-client';

export default async function LinksPage() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) redirect('/auth/login');

  const { data: links } = await supabase
    .from('links')
    .select('*')
    .eq('user_id', user.id)
    .order('sort_order', { ascending: true });

  return <LinksPageClient initialLinks={links || []} />;
}
```

## Payment Flow Implementation

### COD Checkout

```typescript
// /checkout/[productId]/page.tsx
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { toast } from 'sonner';

export default function CheckoutPage({ product }: { product: any }) {
  const [formData, setFormData] = useState({
    shipping_address: '',
    payment_method: 'cod',
  });

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    
    // Create order
    const res = await fetch('/api/orders', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        product_id: product.id,
        quantity: 1,
        ...formData,
      }),
    });

    if (res.ok) {
      toast.success('Order placed! We will contact you soon.');
      router.push('/dashboard');
    }
  }

  return (
    <form onSubmit={handleSubmit} className="max-w-2xl mx-auto p-8">
      <h1 className="text-3xl font-bold mb-8">Checkout</h1>
      
      {/* Shipping Address */}
      <textarea
        required
        rows={4}
        value={formData.shipping_address}
        onChange={(e) => setFormData({ ...formData, shipping_address: e.target.value })}
        placeholder="Enter your complete shipping address..."
        className="w-full px-4 py-3 rounded-lg bg-brand-navy-light border border-white/10 text-white"
      />

      {/* Payment Method */}
      <div className="mt-6 space-y-3">
        <label className="flex items-center gap-3 p-4 glass rounded-lg cursor-pointer">
          <input
            type="radio"
            name="payment"
            value="cod"
            checked={formData.payment_method === 'cod'}
            onChange={() => setFormData({ ...formData, payment_method: 'cod' })}
          />
          <div>
            <div className="font-semibold">Cash on Delivery</div>
            <div className="text-sm text-gray-400">Pay when you receive</div>
          </div>
        </label>

        <label className="flex items-center gap-3 p-4 glass rounded-lg cursor-pointer">
          <input
            type="radio"
            name="payment"
            value="whatsapp"
            checked={formData.payment_method === 'whatsapp'}
            onChange={() => setFormData({ ...formData, payment_method: 'whatsapp' })}
          />
          <div>
            <div className="font-semibold">WhatsApp Order</div>
            <div className="text-sm text-gray-400">Contact via WhatsApp</div>
          </div>
        </label>
      </div>

      <Button type="submit" className="w-full mt-8" size="lg">
        Place Order - ${product.price}
      </Button>
    </form>
  );
}
```

## Next Steps

1. Implement admin pages in `/admin/*`
2. Add proper error boundaries
3. Add loading states to all async operations
4. Test RLS policies thoroughly
5. Add SEO metadata to all pages
6. Optimize images and assets
7. Set up monitoring and analytics
8. Configure CI/CD pipeline
9. Add comprehensive testing

This covers all the critical user-facing functionality. The admin pages follow similar patterns - just add CRUD operations for products, or